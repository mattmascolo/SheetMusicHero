<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MIDI Note Streak Trainer (Sheet Music)</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Load VexFlow for rendering musical notation -->
    <script src="https://unpkg.com/vexflow@4.2.2/build/cjs/vexflow.js"></script>
    <!-- Phosphor Icons -->
    <script src="https://unpkg.com/@phosphor-icons/web"></script>
    <style>
        /* Custom styles for mobile-first aesthetics */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #0d1117;
            color: #e6edf3;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }

        .card {
            background-color: #161b22;
            box-shadow: 0 10px 30px rgba(0, 255, 128, 0.1);
            border: 1px solid #30363d;
            position: relative;
        }

        /* Visual feedback for correct/incorrect notes */
        .feedback-correct {
            animation: flash-green 0.1s ease-out;
        }
        .feedback-incorrect {
            animation: flash-red 0.1s ease-out;
        }
        .feedback-complete {
            animation: flash-blue 0.5s ease-out;
        }

        @keyframes flash-green {
            0% { background-color: #161b22; }
            50% { background-color: #238636; }
            100% { background-color: #161b22; }
        }
        @keyframes flash-red {
            0% { background-color: #161b22; }
            50% { background-color: #da3633; }
            100% { background-color: #161b22; }
        }
        @keyframes flash-blue {
            0% { background-color: #161b22; }
            50% { background-color: #1f6feb; }
            100% { background-color: #161b22; }
        }

        /* Modal Transitions */
        .modal-enter { opacity: 0; transform: scale(0.95); }
        .modal-enter-active { opacity: 1; transform: scale(1); transition: opacity 200ms, transform 200ms; }
        .modal-exit { opacity: 1; transform: scale(1); }
        .modal-exit-active { opacity: 0; transform: scale(0.95); transition: opacity 200ms, transform 200ms; }

        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border: 0;
        }
    </style>
</head>
<body class="p-4">

    <div id="app-container" class="card w-full max-w-sm mx-auto p-6 rounded-xl text-center transition-all duration-100 relative">

        <!-- Settings Button -->
        <button id="settings-btn" class="absolute top-4 right-4 text-gray-400 hover:text-white transition-colors" aria-label="Open settings" aria-controls="settings-modal" aria-haspopup="dialog" aria-expanded="false" type="button">
            <i class="ph ph-gear text-2xl" aria-hidden="true"></i>
        </button>

        <!-- Header -->
        <h1 class="text-3xl font-bold mb-2 text-[#58a6ff]">Note Streak</h1>
        <p class="text-sm text-gray-400 mb-4">Play the note shown on the staff!</p>

        <!-- MIDI Status -->
        <div id="midi-status" class="text-xs font-mono p-2 mb-2 rounded-lg bg-gray-700/50 border border-gray-600 overflow-hidden text-ellipsis" role="status" aria-live="polite">
            <span class="text-yellow-400">Connecting to MIDI...</span>
        </div>
        <button id="retry-midi" type="button" class="text-xs font-semibold text-[#58a6ff] hover:text-white underline-offset-2 hover:underline mb-6">Retry Connection</button>

        <!-- Target Note Display - Now a Canvas for Sheet Music -->
        <div class="mb-8">
            <p id="instruction-text" class="text-lg font-semibold text-gray-300 mb-2" role="status" aria-live="polite">Next Note:</p>
            <!-- Canvas Wrapper for VexFlow rendering -->
            <div class="h-40 flex items-center justify-center bg-white/5 rounded-lg border-2 border-transparent overflow-hidden" id="canvas-wrapper">
                <div id="note-canvas" class="flex justify-center items-center w-11/12" role="img" aria-label="Target note on treble clef staff"></div>
            </div>
            
            <!-- Toggle Note Name -->
            <div class="flex justify-center items-center mt-3 space-x-2">
                <input type="checkbox" id="show-note-name" class="accent-[#58a6ff] h-4 w-4 bg-gray-700 border-gray-600 rounded focus:ring-0 focus:ring-offset-0 cursor-pointer" checked aria-checked="true">
                <label for="show-note-name" class="text-xs text-gray-400 select-none cursor-pointer">Show Note Name</label>
            </div>
        </div>

        <!-- Streak Counter -->
        <div class="mb-6">
            <p class="text-lg font-semibold text-gray-300 mb-2">Current Streak:</p>
            <div id="streak-count" class="text-5xl font-extrabold text-[#fae100]" aria-live="polite">
                0
            </div>
        </div>

        <!-- Last Key Pressed -->
        <div class="text-xs text-gray-500 pt-4 border-t border-gray-700">
            <p id="last-note-info" role="status" aria-live="polite">Last Note: -</p>
        </div>
        
        <p class="text-[10px] text-gray-600 mt-2">Tap anywhere to enable audio if silent</p>

        <!-- Settings Modal -->
        <div id="settings-modal" class="hidden absolute inset-0 bg-[#0d1117]/95 backdrop-blur-sm z-50 rounded-xl flex flex-col items-center justify-center p-6" role="dialog" aria-modal="true" aria-labelledby="settings-title" tabindex="-1" aria-hidden="true">
            <div class="w-full h-full flex flex-col">
                <div class="flex justify-between items-center mb-6">
                    <h2 id="settings-title" class="text-xl font-bold text-white">Settings</h2>
                    <button id="close-settings" class="text-gray-400 hover:text-white" aria-label="Close settings" type="button">
                        <i class="ph ph-x text-2xl" aria-hidden="true"></i>
                    </button>
                </div>

                <div class="flex-1 overflow-y-auto w-full">
                    
                    <!-- Game Mode Selection -->
                    <div class="mb-6 text-left">
                        <p class="text-sm text-gray-400 mb-2">Game Mode:</p>
                        <select id="mode-select" class="w-full bg-gray-800 border border-gray-600 text-white text-sm rounded-lg focus:ring-[#58a6ff] focus:border-[#58a6ff] block p-2.5" aria-label="Select game mode">
                            <option value="random">Random Drill (Default)</option>
                            <!-- Songs will be injected here -->
                        </select>
                    </div>

                    <!-- Note Selection (Only for Random Mode) -->
                    <div id="random-settings-panel">
                        <p class="text-sm text-gray-400 mb-4 text-left">Select Active Notes:</p>
                        <div id="notes-grid" class="grid grid-cols-2 gap-3 text-left" role="group" aria-label="Selectable notes">
                            <!-- Checkboxes generated by JS -->
                        </div>
                        <p id="settings-feedback" class="text-xs text-red-400 mt-2 min-h-[1rem]" role="status" aria-live="assertive"></p>
                        
                        <div class="mt-4 pt-4 border-t border-gray-700 w-full flex justify-between">
                             <button id="select-all-btn" class="text-xs text-[#58a6ff] hover:underline" type="button">Select All</button>
                             <button id="clear-all-btn" class="text-xs text-gray-400 hover:text-white hover:underline" type="button">Clear All</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

    </div>

    <script type="module" src="./main.js"></script>
</body>
</html>
