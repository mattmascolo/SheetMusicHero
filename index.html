<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MIDI Note Streak Trainer (Sheet Music)</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Load VexFlow for rendering musical notation -->
    <script src="https://unpkg.com/vexflow@4.2.2/build/cjs/vexflow.js"></script>
    <!-- Phosphor Icons -->
    <script src="https://unpkg.com/@phosphor-icons/web"></script>
    <link rel="stylesheet" href="./styles.css">
</head>
<body class="p-4">

    <div id="app-container" class="card w-full max-w-sm mx-auto p-6 rounded-xl text-center transition-all duration-100 relative">

        <!-- Settings Button -->
        <button id="settings-btn" class="absolute top-4 right-4 text-gray-400 hover:text-white transition-colors">
            <i class="ph ph-gear text-2xl"></i>
        </button>

        <!-- Header -->
        <h1 class="text-3xl font-bold mb-2 text-[#58a6ff]">Note Streak</h1>
        <p class="text-sm text-gray-400 mb-6">Play the note shown on the staff!</p>

        <!-- MIDI Status -->
        <div id="midi-status" class="text-xs font-mono p-2 mb-6 rounded-lg bg-gray-700/50 border border-gray-600 overflow-hidden text-ellipsis">
            <span class="text-yellow-400">Connecting to MIDI...</span>
        </div>

        <!-- Target Note Display - Now a Canvas for Sheet Music -->
        <div class="mb-8">
            <p id="instruction-text" class="text-lg font-semibold text-gray-300 mb-2">Next Note:</p>
            <!-- Canvas Wrapper for VexFlow rendering -->
            <div class="h-40 flex items-center justify-center bg-white/5 rounded-lg border-2 border-transparent overflow-hidden" id="canvas-wrapper">
                <div id="note-canvas" class="flex justify-center items-center w-11/12"></div>
            </div>
            
            <!-- Toggle Note Name -->
            <div class="flex justify-center items-center mt-3 space-x-2">
                <input type="checkbox" id="show-note-name" class="accent-[#58a6ff] h-4 w-4 bg-gray-700 border-gray-600 rounded focus:ring-0 focus:ring-offset-0 cursor-pointer" checked>
                <label for="show-note-name" class="text-xs text-gray-400 select-none cursor-pointer">Show Note Name</label>
            </div>
        </div>

        <!-- Streak Counter -->
        <div class="mb-6">
            <p class="text-lg font-semibold text-gray-300 mb-2">Current Streak:</p>
            <div id="streak-count" class="text-5xl font-extrabold text-[#fae100]">
                0
            </div>
        </div>

        <!-- Last Key Pressed -->
        <div class="text-xs text-gray-500 pt-4 border-t border-gray-700">
            <p id="last-note-info">Last Note: -</p>
        </div>
        
        <p class="text-[10px] text-gray-600 mt-2">Click anywhere to enable audio if silent</p>

        <!-- Settings Modal -->
        <div id="settings-modal" class="hidden absolute inset-0 bg-[#0d1117]/95 backdrop-blur-sm z-50 rounded-xl flex flex-col items-center justify-center p-6">
            <div class="w-full h-full flex flex-col">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-xl font-bold text-white">Settings</h2>
                    <button id="close-settings" class="text-gray-400 hover:text-white">
                        <i class="ph ph-x text-2xl"></i>
                    </button>
                </div>

                <div class="flex-1 overflow-y-auto w-full">
                    
                    <!-- Game Mode Selection -->
                    <div class="mb-6 text-left">
                        <p class="text-sm text-gray-400 mb-2">Game Mode:</p>
                        <select id="mode-select" class="w-full bg-gray-800 border border-gray-600 text-white text-sm rounded-lg focus:ring-[#58a6ff] focus:border-[#58a6ff] block p-2.5">
                            <option value="random">Random Drill (Default)</option>
                            <!-- Songs will be injected here -->
                        </select>
                    </div>

                    <!-- Note Selection (Only for Random Mode) -->
                    <div id="random-settings-panel">
                        <div class="mb-4 text-left">
                            <p class="text-sm text-gray-400 mb-2">Scale Preset:</p>
                            <select id="scale-select" class="w-full bg-gray-800 border border-gray-600 text-white text-sm rounded-lg focus:ring-[#58a6ff] focus:border-[#58a6ff] block p-2.5">
                                <option value="custom">Custom (manual)</option>
                            </select>
                        </div>

                        <p class="text-sm text-gray-400 mb-4 text-left">Select Active Notes:</p>
                        <div id="notes-grid" class="grid grid-cols-2 gap-3 text-left">
                            <!-- Checkboxes generated by JS -->
                        </div>
                        
                        <div class="mt-4 pt-4 border-t border-gray-700 w-full flex justify-between">
                             <button id="select-all-btn" class="text-xs text-[#58a6ff] hover:underline">Select All</button>
                             <button id="clear-all-btn" class="text-xs text-gray-400 hover:text-white hover:underline">Clear All</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

    </div>
    <script src="./app.js"></script>
</body>
</html>
